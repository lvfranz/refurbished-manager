{% extends 'orders/base.html' %}

{% block title %}Report Articoli Sostituiti - Gestionale Refurbished{% endblock %}

{% block content %}
<div style="margin-bottom: 1.5rem;">
    <a href="{% url 'orders:dashboard' %}" style="color: #667eea; text-decoration: none;">‚Üê Torna alla Dashboard</a>
</div>

<div class="card">
    <h2>üìä Report Articoli Sostituiti</h2>
    <p style="color: #7f8c8d; margin-top: 0.5rem;">
        Elenco completo di tutti gli articoli sostituiti tramite RMA
    </p>

    <div style="margin-top: 1.5rem; padding: 1rem; background-color: #e3f2fd; border-radius: 8px;">
        <strong>Totale RMA: {{ total_rma }}</strong>
    </div>
</div>

{% if sostituzioni %}
<div class="card">
    <h3>Sostituzioni Effettuate</h3>

    <table>
        <thead>
            <tr>
                <th>RMA</th>
                <th>Cliente</th>
                <th>Articolo Vecchio</th>
                <th>Seriale Vecchio</th>
                <th>Articolo Nuovo</th>
                <th>Seriale Nuovo</th>
                <th>Data</th>
                <th>Stato</th>
            </tr>
        </thead>
        <tbody>
            {% for sost in sostituzioni %}
            <tr>
                <td><strong>{{ sost.rma.numero_rma }}</strong></td>
                <td>
                    {% if sost.cliente %}
                    <a href="{% url 'orders:report_cliente_sostituzioni' sost.cliente.pk %}" style="color: #667eea; text-decoration: none;">
                        {{ sost.cliente.nome }}
                    </a>
                    {% else %}
                    -
                    {% endif %}
                </td>
                <td>
                    <strong>{{ sost.articolo_vecchio.articolo.codice_articolo }}</strong><br>
                    <small style="color: #7f8c8d;">{{ sost.articolo_vecchio.articolo.descrizione|truncatewords:5 }}</small>
                </td>
                <td>
                    {% if sost.articolo_vecchio.numero_seriale %}
                    <code style="background: #f5f5f5; padding: 0.25rem 0.5rem; border-radius: 3px;">
                        {{ sost.articolo_vecchio.numero_seriale }}
                    </code>
                    {% else %}
                    -
                    {% endif %}
                </td>
                <td>
                    {% if sost.articolo_nuovo %}
                    <strong>{{ sost.articolo_nuovo.articolo.codice_articolo }}</strong><br>
                    <small style="color: #7f8c8d;">{{ sost.articolo_nuovo.articolo.descrizione|truncatewords:5 }}</small>
                    {% else %}
                    <span style="color: #999;">In attesa</span>
                    {% endif %}
                </td>
                <td>
                    {% if sost.articolo_nuovo and sost.articolo_nuovo.numero_seriale %}
                    <code style="background: #e8f5e9; padding: 0.25rem 0.5rem; border-radius: 3px; color: #2e7d32;">
                        {{ sost.articolo_nuovo.numero_seriale }}
                    </code>
                    {% else %}
                    -
                    {% endif %}
                </td>
                <td>{{ sost.rma.data_apertura|date:"d/m/Y" }}</td>
                <td>
                    {% if sost.rma.stato == 'APERTO' %}
                        <span class="badge badge-info">Aperto</span>
                    {% elif sost.rma.stato == 'IN_LAVORAZIONE' %}
                        <span class="badge badge-warning">In Lavorazione</span>
                    {% elif sost.rma.stato == 'CHIUSO' %}
                        <span class="badge badge-success">Chiuso</span>
                    {% else %}
                        <span class="badge" style="background-color: #999;">{{ sost.rma.get_stato_display }}</span>
                    {% endif %}
                </td>
            </tr>
            {% endfor %}
        </tbody>
    </table>
</div>
{% else %}
<div class="card">
    <div class="empty-state">
        <p>Nessuna sostituzione registrata</p>
    </div>
</div>
{% endif %}

<div style="margin-top: 2rem; text-align: center;">
    <a href="{% url 'orders:dashboard' %}" style="display: inline-block; padding: 0.75rem 1.5rem; background-color: #6c757d; color: white; text-decoration: none; border-radius: 6px;">
        ‚Üê Torna alla Dashboard
    </a>
</div>
{% endblock %}

